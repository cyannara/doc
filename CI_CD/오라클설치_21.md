아마존 리눅스에 오라클 설치  (AMI : Amazon Linux 2023)
======================================================

## 도커로 설치

인스턴스 규모: 최소 4GB 이상의 RAM을 가진 인스턴스(T2 medium 등) 권장하고 swap 메모리 2GB 지정  
 
referer : [docker hub](https://hub.docker.com/r/gvenzl/oracle-xe)

```bash
docker run -d \
       --name oracle-xe \
      -p 1521:1521 \
      -e ORACLE_PASSWORD=system 
      --shm-size=1g \
      -v oracle-volume:/opt/oracle/oradata \
      gvenzl/oracle-xe:21-slim
```
--shm-size=1g: Oracle 메모리 구조(SGA)를 위해 공유 메모리를 1GB 할당합니다. (필수)      

## rpm으로 설치

reference : (Running RPM Pacaages to Install Oracle Database)[https://docs.oracle.com/en/database/oracle/oracle-database/21/ladbi/running-rpm-packages-to-install-oracle-database.html#GUID-BB7C11E3-D385-4A2F-9EAF-75F4F0AACF02]

0. EC2 인스턴스 시작
1. ec2 서버 접속
2. 타임존 변경
3. swap 메모리 생성
4. 오라클 설치

### EC2 인스턴스
인스턴스 규모: 최소 4GB 이상의 RAM을 가진 인스턴스(T2 medium 등) 권장  
스왑(Swap) 설정: 메모리 부족 오류를 방지하기 위해 최소 2~4GB의 스왑 메모리를 설정해야 합니다. 

### ec2 서버 접속
```
ssh -i "dbserver.pem" ec2-user@ip또는도메인  
또는  
putty, Mobaxterm 프로그램이용하여 접속
```

### 타임존 변경
```bash
date
sudo rm /etc/localtime
sudo ln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime
date
```

## swap 메모리 생성

#### root 계정으로 변경
```bash
sudo -i
```

#### 메모리 상태확인
```bash
free -mt
```

#### swap 파일 생성 (5GB)
```bash
mkdir /swap && cd $_
touch /swap/swapfile
dd if=/dev/zero of=/swap/swapfile bs=1M count=5120
```
$_ 는 앞의 명령어의 마지막 인수를 가리킴. 여기서는 생성된 /swap 폴더

#### swap 파일 설정
```bash
chmod 0600 /swap/swapfile
mkswap /swap/swapfile
swapon /swap/swapfile
```

#### swap 파일과 메모리 상태확인
```bash
swapon -s
free -mt
free -h
```

#### 영구적으로 스왑을 등록
```bash
vi /etc/fstab   
  #<= 마지막줄로 이동(shift+G) => 편집모드로변경(o)  => 아래의 내용 복사해서 붙여넣기 => 저장하고 끝내기 (ESC :wq)
```
<pre>
  /swap/swapfile swap swap defaults 0 0
</pre>


#### 패키지 업데이트
```bash
yum update
```

#### 라이브러리(필수패키지) 설치
```bash
yum install libaio bc flex libnsl
```

#### Oracle Preinstall RPM 다운로드 및 설치
Oracle Database 설치에 필요한 커널 파라미터, 사용자 계정(oracle), 필수 라이브러리 등을 자동으로 구성해줍니다  

```bash
cd /usr/local/src

curl -o oracle-database-preinstall-21c-1.0-1.el8.x86_64.rpm https://yum.oracle.com/repo/OracleLinux/OL8/latest/x86_64/getPackage/oracle-database-preinstall-21c-1.0-1.el8.x86_64.rpm

sudo yum -y localinstall oracle-database-preinstall-21c-1.0-1.el8.x86_64.rpm

```

#### Oracle XE RPM 설치
```bash
wget https://download.oracle.com/otn-pub/otn_software/db-express/oracle-database-xe-21c-1.0-1.ol8.x86_64.rpm
sudo yum localinstall oracle-database-xe-21c-1.0-1.ol8.x86_64.rpm
```

#### 환경변수 영구적으로 추가 설정
```bash
vi /etc/profile
 # <= 마지막줄로 이동(shift+G) => 편집모드로변경(o)  => 아래의 내용 복사해서 붙여넣기 => 저장하고 끝내기 (ESC :wq)
```
```
export ORACLE_HOME=/u01/app/oracle/product/11.2.0/xe
export TNS_ADMIN=$ORACLE_HOME/network/admin
export ORACLE_SID=XE
export NLS_LANG=`$ORACLE_HOME/bin/nls_lang.sh`
export ORAENV_ASK=NO
export PATH=$PATH:$ORACLE_HOME/bin
```

#### 오라클 사용자 계정 생성
quiz 부분을 생성할 사용자 계정으로 변경할 것  
```bash
sqlplus  system/패스워드

CREATE USER quiz IDENTIFIED BY `quiz` default TABLESPACE USERS;
GRANT CONNECT, RESOURCE, CREATE JOB, CREATE VIEW, CREATE ANY CONTEXT TO quiz;

SELECT TABLESPACE_NAME FROM DBA_DATA_FILES;
ALTER USER quiz QUOTA UNLIMITED ON USERS;
```


